<!DOCUMENT html><html>	<head>        <title>3</title>		<link rel="stylesheet" type="text/css" href="css/style.css" />        <link rel="stylesheet" type="text/css" href="js/jquery-ui.css">		<script type="text/javascript" src="js/script.js"></script>		<script type="text/javascript" src="js/jquery.js"></script>        <script type="text/javascript" src="js/jquery-ui.js"></script>	</head>		<body>		<embed class="top-ad" src="ads/1.swf" />        <div>            <table>                <tr>                    <td>                        <input type="text" id="number" class="bordered enter-number" />                    </td>                    <td>                        <button id="10" style="background: url('images/buttons/pad_10.png');                            height: 91px; width: 111px; border: none;" onmousedown="mDown(this)" onmouseup="mUp(this)"                            onclick="backspace()"></button>                    </td>                    <td>                        <button id="11" style="background: url('images/buttons/pad_11.png');                            height: 91px; width: 111px; border: none;" onmousedown="mDown(this)" onmouseup="mUp(this)"                                onclick="clr()"></button>                    </td>                </tr>            </table>        </div>		<div class="left-banner" id="leftBanner"></div>		        <div class="numbers" id="numbers">            <table>                <tr>                    <td>                        <button id="1" class="keyBtn" style="background: url('images/buttons/pad_1.png');"                           onmousedown="mDown(this)" onmouseup="mUp(this)" onclick="validateNumberEntry(this)"></button>                    </td>                    <td>                        <button id="2" class="keyBtn" style="background: url('images/buttons/pad_2.png');"                           onmousedown="mDown(this)" onmouseup="mUp(this)" onclick="validateNumberEntry(this)"></button>                    </td>                    <td>                        <button id="3" class="keyBtn" style="background: url('images/buttons/pad_3.png');"                           onmousedown="mDown(this)" onmouseup="mUp(this)" onclick="validateNumberEntry(this)"></button>                    </td>                </tr>                <tr>                    <td>                        <button id="4" class="keyBtn" style="background: url('images/buttons/pad_4.png');"                           onmousedown="mDown(this)" onmouseup="mUp(this)" onclick="validateNumberEntry(this)"></button>                    </td><td>                        <button id="5" class="keyBtn" style="background: url('images/buttons/pad_5.png');"                           onmousedown="mDown(this)" onmouseup="mUp(this)" onclick="validateNumberEntry(this)"></button>                    </td><td width="181">                        <button id="6" class="keyBtn" style="background: url('images/buttons/pad_6.png');"                            onmousedown="mDown(this)" onmouseup="mUp(this)" onclick="validateNumberEntry(this)"></button>                    </td>                </tr>                <tr>                    <td>                        <button id="7" class="keyBtn" style="background: url('images/buttons/pad_7.png');"                            onmousedown="mDown(this)" onmouseup="mUp(this)" onclick="validateNumberEntry(this)"></button>                    </td>                    <td>                        <button id="8" class="keyBtn" style="background: url('images/buttons/pad_8.png');"                            onmousedown="mDown(this)" onmouseup="mUp(this)" onclick="validateNumberEntry(this)"></button>                    </td>                    <td>                        <button id="9" class="keyBtn" style="background: url('images/buttons/pad_9.png');"                            onmousedown="mDown(this)" onmouseup="mUp(this)" onclick="validateNumberEntry(this)"></button>                    </td>                </tr>                <tr>                    <td>&nbsp;</td>                    <td>                        <button id="0" class="keyBtn" style="background: url('images/buttons/pad_0.png');"                            onmousedown="mDown(this)" onmouseup="mUp(this)" onclick="validateNumberEntry(this)"></button>                    </td>                    <td>&nbsp;</td>                </tr>            </table>        </div>		<div class="right-banner" id="rightBanner"></div>        <div class="navigation">            <button id="back" class="leftBtn"></button>            <button id="next" class="rightBtn" disabled></button>        </div>        <div id="MyDialog" title="Выберите из списка"></div>	</body>    <script>        var number = "";        var numberMask = [];        var asteriskMask = "";        var minLen = 0;        var maxEntryLength = 0;        var minEntryLength = 0;        var maxMaskLength = 0;        $(function() {            $( "#MyDialog" ).dialog({                autoOpen: false,                height: 400,                width: 450,                modal: true            });        });        function setProperties(param) {            numberMask = properties.allowedEntries;            asteriskMask = properties.mask;            minLen = properties.minLength;            if(param==""){                number = asteriskMask;            } else {                number = param;                if(param.length >= properties.minLength){                    $('.rightBtn').removeAttr('disabled');                }            }            minEntryLength = minAllowedEntryLength(properties.allowedEntries);            maxEntryLength = maxAllowedEntryLength(properties.allowedEntries);            maxMaskLength = properties.mask.length;            $("#number").val(number);            var div = document.getElementById("MyDialog");            numberMask.forEach(function(entry){                div.innerHTML += "<input type='button' " +                        "id='"+ entry + "' style='background: mediumpurple; font-size: 72px; " +                        "margin: 10px; width: 180px;' onclick='populate(this)' value=" + entry + ">";            });        }        function populate(btn){            number = asteriskMask;            for (var i=0; i< btn.id.length; i++) {                number = number.replaceAt(getAsteriskPos(0), btn.id.charAt(i));            }            $("#number").val(number);            $("#MyDialog").dialog("close");        }        function getAsteriskPos(searchPosition) {            if (searchPosition > number.length || searchPosition < 0) return "-1";            if (number.charAt(searchPosition)=="*"){                return searchPosition;            } else {                searchPosition = getAsteriskPos(searchPosition+1);            }            return searchPosition;        }        function maxAllowedEntryLength(allowedEntries) {            var max = 0;            allowedEntries.forEach(function(entry){                if(entry.length > max){                    max = entry.length;                }            });            return max;        }        function minAllowedEntryLength(allowedEntries) {            var min = 0;            if(allowedEntries.length > 0){                min = allowedEntries[0].length;                allowedEntries.forEach(function(entry){                    if(entry.length < min){                        min = entry.length;                    }                });            }            return min;        }        function validateNumberEntry(btn){            var asteriskIndex = number.indexOf("*");            if(asteriskIndex >= 0){                if (asteriskIndex >= minEntryLength) {                    number = number.replaceAt(asteriskIndex, btn.id);                } else                if(asteriskIndex <= maxEntryLength){                    if(validatePrefix(btn.id)){                        number = number.replaceAt(asteriskIndex, btn.id);                    } else { // Invalid mask entry                        var $div = $('#MyDialog');                        $div.dialog( "open");                        $div.dialog('widget').position({                            my: "left top",                            at: "left bottom",                            of: $div                        });                    }                }            }            if(number.replace("-", "").indexOf("*") > minLen){                //alert("Enabled");                               //todo enable next button here                $('.rightBtn').removeAttr('disabled');            }            $("#number").val(number);        }        function validatePrefix(entry) {            var val = number.substr(0, number.indexOf("*")) + entry;            for (var i=0; i < numberMask.length; i++){                if (numberMask[i].substr(0, val.length) == val) return true;            }            return false;        }        String.prototype.replaceAt=function(index, character) {            return this.substr(0, index) + character + this.substr(index+character.length);        }        function backspace() {            var match = regexLastIndexOf(number, /[0-9]/);            if(match !== -1){                number = number.replaceAt(match, "*");                $("#number").val(number);            }            if(number.replace("-", "").indexOf("*") < minLen){                //alert("Disabled");                              //todo disable next button here                $('.rightBtn').attr('disabled', 'disabled');            }        }        function clr() {            number = asteriskMask;            $("#number").val(number);            if(number.replace("-", "").indexOf("*") < minLen){                //alert("Disabled");                              //todo disable next button here                $('.rightBtn').attr('disabled', 'disabled');            }        }        function regexLastIndexOf(string, regex) {            regex = (regex.global) ? regex : new RegExp(regex.source, "g" +                    (regex.ignoreCase ? "i" : "") + (regex.multiLine ? "m" : ""));            var stringToWorkWith = string.substring(0, string.length + 1);            var lastIndexOf = -1;            var nextStop = 0;            while((result = regex.exec(stringToWorkWith)) != null) {                lastIndexOf = result.index;                regex.lastIndex = ++nextStop;            }            return lastIndexOf;        }    </script></html>